---
test:
  override:
    - coverage run -m py.test --ds=talentsoftomorrow.testing_circleci --nomigrations dashboard/
  post:
    - coverage html -d $CIRCLE_ARTIFACTS

machine:
  python:
    version: 3.5.1
  environment:
    DJANGO_SETTINGS_MODULE: talentsoftomorrow.settings

deployment:
  staging:
    branch: master
    codedeploy:
      my-app:
        application_root: /home/django/envs/dashboard/talentstomorrow/
        revision_location:
          revision_type: S3
          s3_location:
            bucket: staging-bucket
            key_pattern: apps/my-app-{SHORT_COMMIT}-{BUILD_NUM}
        region: eu-west-1b
        deployment_group: staging-instances
        deployment_config: CodeDeployDefault.AllAtOnce